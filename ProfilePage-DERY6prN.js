import{aL as y,a as c,b as Q,w as I,aM as $,ax as Y,v as W,a4 as J,r as S,aN as K,aO as X,j as e,P as x,C as Z,aP as ee,B as M,D as E,E as se,$ as p,e as g,aQ as P,aR as ae,aS as te,aT as T,T as l,H as d,aU as w,aV as re,aW as ie}from"./strapi-DtqVexM2.js";import{g as oe}from"./users-DLc-PG84.js";import{C as ne}from"./validation-CkvmB0re.js";const le=ee().shape({...ne,currentPassword:P().when(["password","confirmPassword"],(a,s,r)=>a||s?r.required({id:ae.required.id,defaultMessage:"This field is required"}).nullable():r),preferedLanguage:P().nullable()}),f=({children:a,...s})=>e.jsx(p,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:e.jsx(g,{direction:"column",alignItems:"stretch",gap:4,...s,children:a})}),ye=()=>{const a=y(o=>o.admin_app.language.localeNames),{formatMessage:s}=c(),{trackUsage:r}=Q(),{toggleNotification:t}=I(),{notifyStatus:i}=$(),v=y(o=>o.admin_app.theme.currentTheme),A=Y(),{_unstableFormatValidationErrors:L,_unstableFormatAPIError:R}=W(),u=J("ProfilePage",o=>o.user);S.useEffect(()=>{u?i(s({id:"Settings.profile.form.notify.data.loaded",defaultMessage:"Your profile data has been loaded"})):t({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occured"})})},[s,i,t,u]);const[C,{isLoading:_}]=K(),{isLoading:N,data:z,error:b}=X(void 0,{skip:!(window.strapi.isEE&&window.strapi.features.isEnabled("sso"))});S.useEffect(()=>{b&&t({type:"danger",message:s({id:"Settings.permissions.users.sso.provider.error"})})},[b,s,t]);const k=async(o,{setErrors:h})=>{const{confirmPassword:pe,currentTheme:j,...V}=o;let m=V;if(m.password===""){const{password:ge,currentPassword:fe,...G}=m;m=G}const n=await C(m);"data"in n&&(A(te(j)),r("didChangeMode",{newMode:j}),t({type:"success",message:s({id:"notification.success.saved",defaultMessage:"Saved"})})),"error"in n&&(T(n.error)&&n.error.name==="ValidationError"?h(L(n.error)):T(n.error)?t({type:"danger",message:R(n.error)}):t({type:"danger",message:s({id:"notification.error",defaultMessage:"An error occured"})}))};if(N)return e.jsx(x.Loading,{});const F=z?.isSSOLocked??!1,{email:U,firstname:O,lastname:B,username:D,preferedLanguage:q}=u??{},H={email:U??"",firstname:O??"",lastname:B??"",username:D??"",preferedLanguage:q,currentTheme:v,confirmPassword:"",password:""};return e.jsxs(x.Main,{"aria-busy":_,children:[e.jsx(x.Title,{children:s({id:"Settings.profile.form.section.head.title",defaultMessage:"User profile"})}),e.jsx(Z,{method:"PUT",onSubmit:k,initialValues:H,validationSchema:le,children:({isSubmitting:o,modified:h})=>e.jsxs(e.Fragment,{children:[e.jsx(M.Header,{title:oe(u),primaryAction:e.jsx(E,{startIcon:e.jsx(se,{}),loading:o,type:"submit",disabled:!h,children:s({id:"global.save",defaultMessage:"Save"})})}),e.jsx(p,{paddingBottom:6,children:e.jsx(M.Content,{children:e.jsxs(g,{direction:"column",alignItems:"stretch",gap:6,children:[e.jsx(ue,{}),!F&&e.jsx(de,{}),e.jsx(ce,{localeNames:a})]})})})]})}),e.jsx(p,{paddingBottom:10,children:e.jsx(M.Content,{children:e.jsx(me,{})})})]})},de=()=>{const{formatMessage:a}=c();return e.jsxs(f,{children:[e.jsx(l,{variant:"delta",tag:"h2",children:a({id:"global.change-password",defaultMessage:"Change password"})}),[[{label:a({id:"Auth.form.currentPassword.label",defaultMessage:"Current Password"}),name:"currentPassword",size:6,type:"password"}],[{autoComplete:"new-password",label:a({id:"global.password",defaultMessage:"Password"}),name:"password",size:6,type:"password"},{autoComplete:"new-password",label:a({id:"Auth.form.confirmPassword.label",defaultMessage:"Confirm Password"}),name:"confirmPassword",size:6,type:"password"}]].map((s,r)=>e.jsx(d.Root,{gap:5,children:s.map(({size:t,...i})=>e.jsx(d.Item,{col:t,direction:"column",alignItems:"stretch",children:e.jsx(w,{...i})},i.name))},r))]})},ce=({localeNames:a})=>{const{formatMessage:s}=c(),r=y(t=>t.admin_app.theme.availableThemes);return e.jsxs(f,{children:[e.jsxs(g,{direction:"column",alignItems:"stretch",gap:1,children:[e.jsx(l,{variant:"delta",tag:"h2",children:s({id:"Settings.profile.form.section.experience.title",defaultMessage:"Experience"})}),e.jsx(l,{children:s({id:"Settings.profile.form.section.experience.interfaceLanguageHelp",defaultMessage:"Preference changes will apply only to you. More information is available {here}."},{here:e.jsx(p,{tag:"a",color:"primary600",target:"_blank",rel:"noopener noreferrer",href:"https://docs.strapi.io/developer-docs/latest/development/admin-customization.html#locales",children:s({id:"Settings.profile.form.section.experience.here",defaultMessage:"here"})})})})]}),e.jsx(d.Root,{gap:5,children:[{hint:s({id:"Settings.profile.form.section.experience.interfaceLanguage.hint",defaultMessage:"This will only display your own interface in the chosen language."}),label:s({id:"Settings.profile.form.section.experience.interfaceLanguage",defaultMessage:"Interface language"}),name:"preferedLanguage",options:Object.entries(a).map(([t,i])=>({label:i,value:t})),placeholder:s({id:"global.select",defaultMessage:"Select"}),size:6,type:"enumeration"},{hint:s({id:"Settings.profile.form.section.experience.mode.hint",defaultMessage:"Displays your interface in the chosen mode."}),label:s({id:"Settings.profile.form.section.experience.mode.label",defaultMessage:"Interface mode"}),name:"currentTheme",options:[{label:s({id:"Settings.profile.form.section.experience.mode.option-system-label",defaultMessage:"Use system settings"}),value:"system"},...r.map(t=>({label:s({id:"Settings.profile.form.section.experience.mode.option-label",defaultMessage:"{name} mode"},{name:s({id:t,defaultMessage:re(t)})}),value:t}))],placeholder:s({id:"components.Select.placeholder",defaultMessage:"Select"}),size:6,type:"enumeration"}].map(({size:t,...i})=>e.jsx(d.Item,{col:t,direction:"column",alignItems:"stretch",children:e.jsx(w,{...i})},i.name))})]})},ue=()=>{const{formatMessage:a}=c();return e.jsxs(f,{children:[e.jsx(l,{variant:"delta",tag:"h2",children:a({id:"global.profile",defaultMessage:"Profile"})}),e.jsx(d.Root,{gap:5,children:[{label:a({id:"Auth.form.firstname.label",defaultMessage:"First name"}),name:"firstname",required:!0,size:6,type:"string"},{label:a({id:"Auth.form.lastname.label",defaultMessage:"Last name"}),name:"lastname",size:6,type:"string"},{label:a({id:"Auth.form.email.label",defaultMessage:"Email"}),name:"email",required:!0,size:6,type:"email"},{label:a({id:"Auth.form.username.label",defaultMessage:"Username"}),name:"username",size:6,type:"string"}].map(({size:s,...r})=>e.jsx(d.Item,{col:s,direction:"column",alignItems:"stretch",children:e.jsx(w,{...r})},r.name))})]})},me=()=>{const{formatMessage:a}=c(),{toggleNotification:s}=I(),r=ie("ProfilePage",i=>i.dispatch),t=()=>{r({type:"reset_all_tours"}),s({type:"success",message:a({id:"tours.profile.notification.success.reset",defaultMessage:"Guided tour reset"})})};return e.jsxs(f,{alignItems:"start",children:[e.jsxs(g,{direction:"column",alignItems:"start",gap:1,children:[e.jsx(l,{variant:"delta",tag:"h2",children:a({id:"tours.profile.title",defaultMessage:"Guided tour"})}),e.jsx(l,{variant:"pi",children:a({id:"tours.profile.description",defaultMessage:"You can reset the guided tour at any time."})})]}),e.jsx(E,{variant:"tertiary",onClick:t,children:a({id:"tours.profile.reset",defaultMessage:"Reset guided tour"})})]})};export{ye as ProfilePage};
